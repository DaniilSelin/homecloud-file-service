# File Service API Documentation

## Протестированные эндпоинты

### Файлы

#### GET `/api/v1/files`
- **Описание**: Получение списка файлов в указанной папке
- **Параметры запроса**:
  - `parent_id` (query, optional) - UUID родительской папки. Если не указан, возвращает файлы из корневой папки
- **Ответ**: 
  ```json
  {
    "files": [
      {
        "id": "uuid",
        "name": "example.txt",
        "mime_type": "text/plain",
        "size": 1234,
        "is_folder": false,
        "created_at": "2024-01-01T00:00:00Z",
        "updated_at": "2024-01-01T00:00:00Z"
      }
    ],
    "total": 1
  }
  ```
- **Статусы**:
  - 200: Успешно
  - 401: Не авторизован
- **Тест**: `TestFileOperations/List_Files_in_Folder`

#### POST `/api/v1/files`
- **Описание**: Создание нового файла или папки
- **Тело запроса**:
  ```json
  {
    "name": "example.txt",
    "content": "base64_encoded_content",
    "mime_type": "text/plain",
    "size": 1234,
    "parent_id": "optional_folder_uuid",
    "is_folder": false
  }
  ```
- **Особенности**:
  - Для создания папки установите `is_folder: true` и `mime_type: "application/x-directory"`
  - Контент файла должен быть закодирован в base64
  - Размер указывается в байтах исходного контента (до кодирования в base64)
- **Ответ**: 
  ```json
  {
    "id": "uuid",
    "name": "example.txt",
    "mime_type": "text/plain",
    "size": 1234,
    "is_folder": false,
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  }
  ```
- **Статусы**:
  - 201: Создано успешно
  - 400: Неверный формат запроса
  - 401: Не авторизован
  - 409: Конфликт имен (файл уже существует)
- **Тесты**: 
  - `TestFileOperations/Create_Folder`
  - `TestFileOperations/Create_File_in_Folder`

#### GET `/api/v1/files/{id}`
- **Описание**: Получение информации о файле или папке
- **Параметры пути**:
  - `id` - UUID файла или папки
- **Ответ**: 
  ```json
  {
    "id": "uuid",
    "name": "example.txt",
    "mime_type": "text/plain",
    "size": 1234,
    "is_folder": false,
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  }
  ```
- **Статусы**:
  - 200: Успешно
  - 401: Не авторизован
  - 404: Файл не найден
- **Тест**: `TestFileOperations/Get_File_Details`

#### DELETE `/api/v1/files/{id}`
- **Описание**: Удаление файла или папки
- **Параметры пути**:
  - `id` - UUID файла или папки
- **Особенности**:
  - При удалении папки все её содержимое удаляется рекурсивно
  - Операция необратима
- **Статусы**:
  - 200: Удалено успешно
  - 401: Не авторизован
  - 404: Файл не найден
- **Тесты**:
  - `TestFileOperations/Delete_File`
  - `TestFileOperations/Delete_Folder`

#### GET `/api/v1/files/{id}/download`
- **Описание**: Скачивание файла
- **Параметры пути**:
  - `id` - UUID файла
- **Заголовки ответа**:
  - `Content-Type`: MIME-тип файла
  - `Content-Length`: размер файла в байтах
  - `Content-Disposition`: attachment; filename="имя_файла"
- **Статусы**:
  - 200: Успешно
  - 401: Не авторизован
  - 404: Файл не найден
- **Статус тестирования**: ⚠️ Требует тестов

## Общие особенности

### Аутентификация
- Все запросы (кроме `/health`) требуют заголовок `Authorization: Bearer <token>`
- Токен должен быть получен от auth-service
- Неверный или истекший токен вернет статус 401

### Обработка ошибок
- Все ошибки возвращаются в формате:
  ```json
  {
    "error": "описание ошибки"
  }
  ```
- При конфликте имен файлов возвращается дополнительная информация:
  ```json
  {
    "error": "File with this name already exists",
    "details": {
      "fileName": "example.txt",
      "suggestion": "example (1).txt",
      "message": "A file named 'example.txt' already exists in this location. Try using 'example (1).txt' instead."
    }
  }
  ```

## Прогресс тестирования

✅ Полностью протестировано:
- Создание файлов и папок
- Получение информации о файлах и папках
- Листинг содержимого папок
- Удаление файлов и папок
- Базовая аутентификация

⏳ Требует тестирования:
- Скачивание файлов
- Возобновляемая загрузка
- Возобновляемое скачивание
- Range-запросы
- Обработка больших файлов
- Проверка целостности файлов

❌ Не реализовано:
- Перемещение файлов
- Копирование файлов
- Переименование файлов
- Управление правами доступа
- Поиск файлов
- Работа с метаданными 