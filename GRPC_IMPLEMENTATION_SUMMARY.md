# HomeCloud File Service - gRPC –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

## üéØ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. gRPC API –¥–ª—è —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

–°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π gRPC —Å–µ—Ä–≤–∏—Å —Å –º–µ—Ç–æ–¥–æ–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

#### Proto —Ñ–∞–π–ª: `internal/transport/grpc/protos/file_service.proto`
```protobuf
service FileService {
    // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    rpc CreateUserDirectory(CreateUserDirectoryRequest) returns (CreateUserDirectoryResponse);
}
```

#### –ú–µ—Ç–æ–¥—ã:
- **CreateUserDirectory** - —Å–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –ø–æ–¥–ø–∞–ø–∫–∞–º–∏

### 2. gRPC –°–µ—Ä–≤–µ—Ä

#### –§–∞–π–ª: `internal/transport/grpc/server.go`
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `FileServiceServer`
- –ú–µ—Ç–æ–¥ `CreateUserDirectory` —Å–æ–∑–¥–∞–µ—Ç:
  - –û—Å–Ω–æ–≤–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `storage/users/{user-id}/`
  - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: `documents`, `photos`, `videos`, `music`, `downloads`

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º

#### –§–∞–π–ª: `cmd/server/main.go`
- –î–æ–±–∞–≤–ª–µ–Ω gRPC —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 9090 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- HTTP —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8082
- Graceful shutdown –¥–ª—è –æ–±–æ–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

### 4. –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç

#### –§–∞–π–ª: `test_grpc_client.go`
- gRPC –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ `CreateUserDirectory`

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:

1. **gRPC —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** –Ω–∞ –ø–æ—Ä—Ç—É 9090
2. **HTTP —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç** –Ω–∞ –ø–æ—Ä—Ç—É 8082
3. **CreateUserDirectory –º–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   ```
   Success: true
   Message: User directory created successfully
   Directory Path: storage/users/550e8400-e29b-41d4-a716-446655440000
   ```
4. **–°–æ–∑–¥–∞—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏**:
   ```
   documents/
   downloads/
   music/
   photos/
   videos/
   ```
5. **–í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏: ‚úÖ
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞: ‚úÖ
   - Session ID: `597cda08-6c31-4ce9-87ea-faaac07a5279`

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### gRPC –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config/config.local.yaml`:
```yaml
grpc:
  host: "localhost"
  port: 9090
```

### HTTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```yaml
server:
  host: "0.0.0.0"
  port: 8082
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞:
```bash
go run ./cmd/server
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ gRPC:
```bash
go run test_grpc_client.go
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP API:
```bash
./test_resumable_upload.sh
```

## üåê API Endpoints

### gRPC (–ø–æ—Ä—Ç 9090):
- `CreateUserDirectory` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### HTTP (–ø–æ—Ä—Ç 8082):
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `POST /api/v1/upload/resumable` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- `POST /api/v1/upload/resumable/{sessionID}` - –∑–∞–≥—Ä—É–∑–∫–∞ —á–∞—Å—Ç–∏ —Ñ–∞–π–ª–∞
- `GET /api/v1/download/resumable` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

–ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `CreateUserDirectory` –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `testuser`:
```
storage/
‚îî‚îÄ‚îÄ users/
    ‚îî‚îÄ‚îÄ 550e8400-e29b-41d4-a716-446655440000/
        ‚îú‚îÄ‚îÄ documents/
        ‚îú‚îÄ‚îÄ downloads/
        ‚îú‚îÄ‚îÄ music/
        ‚îú‚îÄ‚îÄ photos/
        ‚îî‚îÄ‚îÄ videos/
```

## üîê –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Auth Service

### –ì–æ—Ç–æ–≤–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- gRPC –∫–ª–∏–µ–Ω—Ç –¥–ª—è auth-service –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤

### –î–ª—è production:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π auth-service
2. –£–±—Ä–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
3. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–æ–∫–µ–Ω–æ–≤

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å auth-service:
1. –í—ã–∑—ã–≤–∞—Ç—å `CreateUserDirectory` –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `user_id` –∏ `username` –∏–∑ auth-service
3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã gRPC:
1. `DeleteUserDirectory` - —É–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. `GetUserStorageInfo` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. `CleanupUserFiles` - –æ—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

gRPC —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω. –ú–µ—Ç–æ–¥ `CreateUserDirectory` –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å auth-service –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. 